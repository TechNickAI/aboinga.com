{% extends 'base.html' %}
{% load verbatim %}

{% block content %}
<div id="momentContainer">
  <div id="uploadContainer">
    <link rel="stylesheet" href="http://upload.aboinga.com/jquery.fileupload-ui.css">
    Upload yours. Browse or Drag n' Drop.<br />
    <input id="fileupload" type="file" name="files[]" multiple="true"/>
    <div class="fileupload-buttonbar">
	<div class="progressbar fileupload-progressbar" style="display:none"><div style="width:0%;"></div></div>
    </div>
    <script src="http://upload.aboinga.com/vendor/jquery.ui.widget.js"></script>
    <script src="http://upload.aboinga.com/jquery.fileupload.js"></script>
    <script>
    $(function () {
	$('#fileupload').fileupload({
	    dataType: 'json',
	    url: 'http://upload.aboinga.com/php/',
	    limitConcurrentUploads: 2,
	    limitMultiFileUploads: 4,
	    done: function (e, data) {
		$.each(data.result, function (index, file) {
		    $.ajax({
			type: 'POST',
			url: "/api/v1/moment/upload/",
			data: { "file": file.name },
			success: function(data) {
				var newMoment = $(ich.momentSummary(data)).hide();
				jQuery("#moments").prepend(newMoment);
				newMoment.fadeIn("slow");
			}
		    });
		});
	    },
            // Callback for global upload progress events:
            progressall: function (e, data) {
                $('.fileupload-progressbar div').css('width', parseInt(data.loaded / data.total * 100, 10) + '%');
	    },
            // Callback for uploads start, equivalent to the global ajaxStart event:
            start: function () {
                $('.fileupload-progressbar div').css('width', '0%');
                $('.fileupload-progressbar').fadeIn();
            },
            // Callback for uploads stop, equivalent to the global ajaxStop event:
            stop: function () {
                $('.fileupload-progressbar').fadeOut()
            }
	});
    });
    </script>
  </div><!-- #uploadContainer -->

  <div id="momentHeader"></div>
  <div id="moments"></div>
</div><!-- #momentContainer -->

{% verbatim %}
<script id="momentSummary" type="text/html">
<li class="moment" id="moment_{{id}}" >
	<img class="photo" src="{{ photo }}"/><br />
	<div class="uploadedInfo">Uploaded <span title="{{created_at}}">{{ created_at_ago }} by {{upload_ip}}</div>
	<div class="momentActions">
	  <img class="action rate" title="Forgettable" data-id="{{id}}" data-rating="1" src="/static/img/rating_star_empty.gif"/>
	  <img class="action rate" title="Inconsequential" data-id="{{id}}" data-rating="2" src="/static/img/rating_star_empty.gif"/>
	  <img class="action rate" title="Eventful" data-id="{{id}}" data-rating="3" src="/static/img/rating_star_empty.gif"/>
	  <img class="action rate" title="Noteworthy" data-id="{{id}}" data-rating="4" src="/static/img/rating_star_empty.gif"/>
	  <img class="action rate" title="Significant" data-id="{{id}}" data-rating="5" src="/static/img/rating_star_empty.gif"/>
	  <img class="action rate" title="Remarkable" data-id="{{id}}" data-rating="6" src="/static/img/rating_star_empty.gif"/>
	  <img class="action rate" title="Exceptional" data-id="{{id}}" data-rating="7" src="/static/img/rating_star_empty.gif"/>
	  <img class="action rate" title="Monumental" data-id="{{id}}" data-rating="8" src="/static/img/rating_star_empty.gif"/>
	  <img class="action rate" title="Epic" data-id="{{id}}" data-rating="9" src="/static/img/rating_star_empty.gif"/>
	  <img class="action rate" title="Legendary" data-id="{{id}}" data-rating="10" src="/static/img/rating_star_empty.gif"/>
	  &nbsp;
	  <img class="action flag" title="Flag as inappropriate" data-id="{{id}}" src="/static/img/flag_blue.png">
	  <img class="action delete" title="Take it down" data-id="{{id}}" src="/static/img/delete.png">
	</div>
</li>
</script>
{% endverbatim %}

<script src="/static/js/home.js"></script>
<script>home();</script>

{% endblock content %}
